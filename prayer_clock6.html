<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mosque Display Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        background: #f4f4f4;
        font-family: Arial, sans-serif;
        overflow: hidden;
    }

    /* HEADER */
    #header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 30px;
        background: #003366;
        color: white;
        height: 12vh;
    }

    #header .logo {
        height: 60px;
    }

    #header .title {
        font-size: 2.5rem;
        font-weight: bold;
        flex: 1;
        text-align: center;
    }

    #header .clock {
        font-size: 4rem;
        font-weight: bold;
        margin-right: 30px;
    }

    #header .dates {
        text-align: right;
        font-size: 1.2rem;
        line-height: 1.4rem;
    }

    /* MAIN CONTENT AREA */
    #main {
        display: flex;
        height: 70vh;
    }

    #content-box {
        width: 33%;
        background: #ffffff;
        padding: 20px;
        font-size: 1.8rem;
        overflow: hidden;
        border-right: 3px solid #ccc;
    }

    #video-box {
        width: 67%;
        background: black;
    }

    #video-box video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* ANNOUNCEMENT BAR */
    #announcement {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 8vh;
        background: #222;
        color: #fff;
        display: flex;
        align-items: center;
        overflow: hidden;
        font-size: 1.8rem;
        font-weight: bold;
        padding-left: 20px;
    }

    #announcementText {
        white-space: nowrap;
        display: inline-block;
        opacity: 0;
    }

    @keyframes scroll-left {
        from { transform: translateX(0); }
        to { transform: translateX(-100%); }
    }

    #fullscreen-controls {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.5s ease;
    }

    #fullscreen-controls.hidden {
        opacity: 0;
        pointer-events: none;
    }

    #fullscreen-controls button {
        padding: 8px 14px;
        font-size: 1rem;
        border: none;
        border-radius: 6px;
        background: #222;
        color: white;
        cursor: pointer;
    }

    #fullscreen-controls button:hover {
        background: #444;
    }

    #info-bar {
        width: 100%;
        height: 6vh; /* adjustable */
        background: linear-gradient(90deg, #0a0a0a, #1a1a1a, #0a0a0a); 
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0px;
        font-size: 1.6rem;
        font-weight: 700;
        border-top: 2px solid #333;
        border-bottom: 2px solid #333;
    }

</style>
</head>

<body>

<!-- HEADER -->
<div id="header">
    <img src="logo.png" class="logo" alt="Logo">

    <div class="title">UMAR MASJID PRAYER TIMES</div>

    <div class="clock" id="clock">00:00:00</div>

    <div class="dates">
        <div id="gregorian-date">Loading...</div>
        <div id="hijri-date">Loading...</div>
        <div id="weatherBox">Loading weather...</div>
    </div>
</div>

<div id="fullscreen-controls">
    <button onclick="toggleFullscreen()">â›¶ Full Screen</button>
</div>

<!-- MAIN CONTENT -->
<div id="main">
    <div id="content-box">
        <iframe 
            src="PrayerTimesPanel.html" 
            style="width:100%; height:100%; border:none; overflow:hidden;">
        </iframe>
    </div>


    <div id="video-box">
        <iframe 
            width="100%" 
            height="100%" 
            src="https://www.youtube.com/embed/M8dHFJF_4Rc?autoplay=1&mute=1&loop=1&playlist=M8dHFJF_4Rc&controls=0&modestbranding=1"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen>
            playsinline>
        </iframe>
    </div>
</div>
    
<div id="info-bar">
      <div class="row">
        <span class="left-glow" id="infoLeft">
            ğŸ“¢ Juma Urdu Speech: 12:30
        </span>
      </div>

      <div class="row">
        <span class="right-glow" id="infoRight">
            ğŸ•Œ Friday Khutba: 13:00
        </span>
    </div>

    <div class="row">
        <span class="right-glow" id="infoRight2">
            ğŸ“… Madrasah Reopens: 7 Jan 2026
        </span>
    </div>
  </div>

  <!-- ANNOUNCEMENT BAR -->
  <div id="announcement">
      <div id="announcementText"></div>
  </div>

<script>
let state = {};  // FIXED

/* ===========================
   01. Digital Clock
   =========================== */
function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText = now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

/* ===========================
   02. Gregorian Date
   =========================== */
document.getElementById("gregorian-date").innerText =
    new Date().toLocaleDateString("en-GB", { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

/* HIJRI DATE */
function updateHijri() {
    const today = new Date();
    const hijri = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
        day: "numeric",
        month: "long",
        year: "numeric"
    }).format(today);

    document.getElementById("hijri-date").innerText = hijri;
}
updateHijri();

/* ===========================
   03. Full Screen
   =========================== */

let hideTimeout;

// FULLSCREEN TOGGLE
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        openFullscreen();
    } else {
        closeFullscreen();
    }
}

function openFullscreen() {
    const elem = document.documentElement;
    if (elem.requestFullscreen) elem.requestFullscreen();
    else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
}

function closeFullscreen() {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    else if (document.msExitFullscreen) document.msExitFullscreen();
}

/* ====================================
   04. Auto Fullscreen After 10 Seconds
   ==================================*/

setTimeout(() => {
    if (!document.fullscreenElement) {
        openFullscreen();
    }
}, 10000); // 10 seconds
// AUTO-HIDE CONTROLS
function showControls() {
    const controls = document.getElementById("fullscreen-controls");
    controls.classList.remove("hidden");

    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
        controls.classList.add("hidden");
    }, 10000); // 10 seconds
}

// SHOW ON MOUSE MOVE
document.addEventListener("mousemove", showControls);

// INITIAL HIDE TIMER
showControls();

// KEYBOARD SHORTCUT (F11)
document.addEventListener("keydown", (e) => {
    if (e.key === "F11") {
        e.preventDefault();
        toggleFullscreen();
    }
});

/* ===========================
   05. Weather (safe)
   =========================== */
async function loadWeather() {
  try {
    const lat = state.coords.lat;
    const lon = state.coords.lon;

    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
    const data = await res.json();

    const temp = data.current_weather.temperature;
    const wind = data.current_weather.windspeed;
    const code = data.current_weather.weathercode;

    const icons = {
      0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",
      45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",
      51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ¦ï¸",
      61:"ğŸŒ§ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",
      71:"â„ï¸",73:"â„ï¸",75:"â„ï¸",
      95:"â›ˆï¸",96:"â›ˆï¸",99:"â›ˆï¸"
    };

    const icon = icons[code] || "ğŸŒ¤ï¸";

    let tempColor = "#22c55e";
    if (temp <= 0) tempColor = "#3b82f6";
    else if (temp <= 10) tempColor = "#0ea5e9";
    else if (temp <= 20) tempColor = "#22c55e";
    else if (temp <= 30) tempColor = "#f59e0b";
    else tempColor = "#ef4444";

    const weatherEl = document.getElementById("weatherBox");
    if (weatherEl)
      weatherEl.innerHTML =
  `<div style="display:flex;align-items:center;gap:8px;font-size:18px;">
      <span>${icon}</span>
      <span style="font-size:16px;font-weight:600;color:${tempColor};Weather: ">${temp}Â°C</span>
      <span style="font-size:14px;opacity:0.8;">ğŸ’¨ ${wind} km/h â¬…ï¸ Weather</span>
   </div>`;

  } catch (err) {
    console.error("Weather error", err);
    const weatherEl = document.getElementById("weatherBox");
    if (weatherEl) weatherEl.textContent = "Weather unavailable";
  }
}

async function init() {
  state.coords = {
    lat: 52.47107996227851,
    lon: -2.0349574320927606
  };

  await loadWeather();
}

init(); // FIXED

/* ===========================
   06. Auto Refresh + Cache Bust (Safe)
   =========================== */

window.addEventListener("load", () => {
    setInterval(() => {
        const cacheBuster = "?v=" + Date.now();
        window.location.href = window.location.pathname + cacheBuster;
    }, 60 * 60 * 1000);
});

/* ===========================
   07. Daily Scheduled Reload (3AM/PM)
   =========================== */

setInterval(() => {
    const now = new Date();

    // Trigger at 3:00 AM OR 3:00 PM
    if ((now.getHours() === 3 || now.getHours() === 15) && now.getMinutes() === 0) {
        window.location.href = window.location.pathname + "?v=" + Date.now();
    }

}, 60 * 1000); // check every minute

/* ===========================
   08. Fullscreen Watchdog
   =========================== */

setInterval(() => {
    if (!document.fullscreenElement) {
        openFullscreen();
    }
}, 2000); // check every 2 seconds

/* ===========================
   09. Heartbeat Freeze Detector
   =========================== */

let lastTick = Date.now();

// Track clock updates
setInterval(() => {
    lastTick = Date.now();
}, 1000); // your clock updates every second

// Watchdog
setInterval(() => {
    if (Date.now() - lastTick > 10000) { // 10 seconds freeze
        window.location.href = window.location.pathname + "?v=" + Date.now();
    }
}, 5000);

/* ===========================
   10. YouTube Iframe Crash Recovery
   =========================== */

let ytLastAlive = Date.now();

// Heartbeat: ping the iframe every 5 seconds
setInterval(() => {
    const iframe = document.querySelector("#video-box iframe");

    if (!iframe) return;

    // If iframe contentWindow exists, assume it's alive
    try {
        if (iframe.contentWindow) {
            ytLastAlive = Date.now();
        }
    } catch (e) {
        // Cross-origin errors are normal â€” ignore
    }
}, 5000);

// Watchdog: if iframe hasn't responded for 20 seconds, reload it
setInterval(() => {
    if (Date.now() - ytLastAlive > 20000) {
        const iframe = document.querySelector("#video-box iframe");
        if (iframe) {
            const src = iframe.src;
            iframe.src = src; // reload iframe only
            ytLastAlive = Date.now();
        }
    }
}, 7000);

/* ===========================
   11. Announcements
   =========================== */

const announcements = [
    "ğŸ•Œ Welcome to the Umar Masjid News & Updates â€” Please maintain silence ğŸ¤«",
    "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Madrasah Parents' Evening on Tuesday 6 Jan",
    "ğŸŒ™ Madrasah Upcoming Event: Isra wal Mi'raj & Speech Competition on Friday 16 Jan",
    "ğŸ“˜ Madrasah Classes: Mon to Fri from 5 PM to 06:30 PM",
    "ğŸ“– Hifz Class: Mon to Fri from 5PM to 7PM",
    "ğŸ—“ï¸ Weekend Madrasah: Every Saturday Morning from 11:00 AM to 01:00 PM",
    "ğŸŒŸ Mini Muslim: Every Sunday Morning from 11:00 AM to 12:30 PM",
    "ğŸ“š Urdu Quran Class: For Adults, Every Mon & Fri from 07:20 to 08:30 PM",
    "ğŸ“š English Quran Class: For Adults, Every Wed from 07:20 to 08:30 PM",
    "ğŸ‘­ Sister's Circle: About Islam Every Tuesday & Sunday",
    "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Next Family Circle: Date to be Announced",
    "ğŸ¤² Jazakumullahu Khairan"
];
let index = 0;

function showAnnouncement() {
    const box = document.getElementById("announcementText");

    // Set text
    box.innerText = announcements[index];

    // Reset animation
    box.style.animation = "none";
    void box.offsetWidth; // force reflow

    // Apply animation
    box.style.animation = "scroll-left 20s linear forwards";

    // Move to next announcement
    index = (index + 1) % announcements.length;

    // Pause 1 second after scroll ends
    setTimeout(showAnnouncement, 13000);
}

// Animation keyframes
const style = document.createElement("style");
style.innerHTML = `
@keyframes scroll-left {
    0% {
        transform: translateX(100%);
        opacity: 1;
    }
    90% {
        transform: translateX(-100%);
        opacity: 1;
    }
    100% {
        opacity: 0;
    }
}`;
document.head.appendChild(style);

window.onload = showAnnouncement;

</script>

</body>

</html>













